<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Car Dodge Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --ui-bg: #111;
      --canvas-bg: #1e1e1e;
      --road: #2b2b2b;
      --lane: #dcdcdc;
      --edge: #555;
      --car: #e74c3c;
      --obstacle: #3498db;
      --text: #fff;
      --accent: #ffbb33;
      --btn: #28a745;
      --btn-hover: #218838;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(180deg, var(--ui-bg), #000);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      display: grid;
      place-items: center;
    }
    .wrap {
      width: 100%;
      max-width: 460px;
      padding: 16px;
      box-sizing: border-box;
      text-align: center;
    }
    h1 {
      margin: 0 0 10px;
      font-weight: 700;
      letter-spacing: 0.2px;
      color: var(--accent);
      font-size: 22px;
    }
    .controls {
      margin-bottom: 10px;
    }
    #playBtn {
      padding: 10px 20px;
      font-size: 16px;
      background: var(--btn);
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }
    #playBtn:hover { background: var(--btn-hover); }
    canvas {
      width: 100%;
      height: auto;
      background: var(--canvas-bg);
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.45);
      display: block;
      margin: 0 auto;
    }
    .hint {
      margin-top: 8px;
      font-size: 12px;
      color: #cfcfcf;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Car Dodge Game</h1>
    <div class="controls">
      <button id="playBtn">Play</button>
    </div>
    <canvas id="game" width="400" height="600" aria-label="Game canvas"></canvas>
    <div class="hint">Use Arrow Left / Arrow Right to move. Press Space to restart after crash.</div>
  </div>

  <script>
    // Canvas setup
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const playBtn = document.getElementById('playBtn');

    // Game state
    const STATE = { MENU: 'menu', PLAYING: 'playing', GAMEOVER: 'gameover' };
    let gameState = STATE.MENU;

    // World and visuals
    const road = {
      margin: 40,             // left/right margin
      laneWidth: 10,          // lane dash width
      laneHeight: 30,         // dash height
      laneGap: 20,            // gap between dashes
      scroll: 0,              // scroll offset
      edges: 6                // road edge thickness
    };

    // Player
    const player = {
      x: 0,
      y: 0,
      w: 40,
      h: 70,
      speed: 280 // px per second
    };

    // Obstacles
    let obstacles = [];
    let baseObstacleSpeed = 140;  // px/s starting
    let spawnEvery = 1.2;         // seconds
    let spawnTimer = 0;

    // Input
    const keys = {};
    document.addEventListener('keydown', e => {
      keys[e.key] = true;
      if (gameState === STATE.GAMEOVER && e.key === ' ') {
        startGame();
      }
    });
    document.addEventListener('keyup', e => { keys[e.key] = false; });

    // Score
    let score = 0;

    // Time
    let last = performance.now();

    // Start/Reset
    function startGame() {
      gameState = STATE.PLAYING;
      playBtn.style.display = 'none';

      // Initialize player at bottom center of road
      const roadLeft = road.margin + road.edges;
      const roadRight = canvas.width - road.margin - road.edges;
      const roadWidth = roadRight - roadLeft;

      player.w = 40;
      player.h = 70;
      player.x = roadLeft + (roadWidth - player.w) / 2;
      player.y = canvas.height - player.h - 20;

      // Reset world
      obstacles = [];
      baseObstacleSpeed = 140;
      spawnEvery = 1.1;
      spawnTimer = 0;
      road.scroll = 0;
      score = 0;
    }

    // Menu state draw
    function drawMenu() {
      drawRoad(0);
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 26px system-ui, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Car Dodge Game', canvas.width/2, canvas.height/2 - 30);

      ctx.font = '14px system-ui, sans-serif';
      ctx.fillStyle = '#e0e0e0';
      ctx.fillText('Press Play to start', canvas.width/2, canvas.height/2 + 10);
      ctx.fillText('Use Arrow Left / Arrow Right to move', canvas.width/2, canvas.height/2 + 35);
    }

    // Game over overlay
    function drawGameOver() {
      ctx.fillStyle = 'rgba(0,0,0,0.55)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#ff5252';
      ctx.font = 'bold 30px system-ui, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 10);

      ctx.fillStyle = '#ffffff';
      ctx.font = '16px system-ui, sans-serif';
      ctx.fillText(`Score: ${Math.floor(score)}`, canvas.width/2, canvas.height/2 + 18);
      ctx.fillText('Press Play to try again (or Space)', canvas.width/2, canvas.height/2 + 44);
    }

    // Draw road with edges and moving lane dashes
    function drawRoad(dt) {
      // Background
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--road').trim() || '#2b2b2b';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Road edges
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--edge').trim() || '#555';
      ctx.fillRect(road.margin, 0, road.edges, canvas.height); // left edge
      ctx.fillRect(canvas.width - road.margin - road.edges, 0, road.edges, canvas.height); // right edge

      // Center lane dashes (scrolling)
      if (dt) {
        road.scroll += (baseObstacleSpeed * 0.6) * dt;
        const patternHeight = road.laneHeight + road.laneGap;
        if (road.scroll >= patternHeight) road.scroll -= patternHeight;
      }

      const centerX = canvas.width / 2;
      const patternHeight = road.laneHeight + road.laneGap;
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--lane').trim() || '#dcdcdc';

      for (let y = -road.laneHeight; y < canvas.height + road.laneHeight; y += patternHeight) {
        const drawY = y + (road.scroll || 0);
        ctx.fillRect(centerX - road.laneWidth/2, drawY, road.laneWidth, road.laneHeight);
      }
    }

    // Draw player car (rounded rectangle + windshield)
    function drawPlayer() {
      roundedRect(player.x, player.y, player.w, player.h, 8, getVar('--car', '#e74c3c'));
      // windshield highlight
      ctx.fillStyle = 'rgba(255,255,255,0.15)';
      ctx.fillRect(player.x + 6, player.y + 10, player.w - 12, 14);
    }

    // Draw obstacle
    function drawObstacle(o) {
      roundedRect(o.x, o.y, o.w, o.h, 6, getVar('--obstacle', '#3498db'));
    }

    // Utility: rounded rect
    function roundedRect(x, y, w, h, r, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.arcTo(x + w, y, x + w, y + h, r);
      ctx.arcTo(x + w, y + h, x, y + h, r);
      ctx.arcTo(x, y + h, x, y, r);
      ctx.arcTo(x, y, x + w, y, r);
      ctx.closePath();
      ctx.fill();
    }
    function getVar(name, fallback) {
      const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      return v || fallback;
    }

    // Spawning
    function trySpawn(dt) {
      spawnTimer += dt;
      const roadLeft = road.margin + road.edges;
      const roadRight = canvas.width - road.margin - road.edges;
      const roadWidth = roadRight - roadLeft;

      if (spawnTimer >= spawnEvery) {
        spawnTimer = 0;

        // Spawn in one of three lanes to feel organized
        const lanes = 3;
        const laneW = roadWidth / lanes;
        const laneIndex = Math.floor(Math.random() * lanes);
        const w = 38, h = 66;

        const x = roadLeft + laneIndex * laneW + (laneW - w) / 2;
        const y = -h - 10;
        const vy = baseObstacleSpeed + Math.random() * 60;

        obstacles.push({ x, y, w, h, vy });
        // Slightly ramp difficulty
        if (spawnEvery > 0.65) spawnEvery -= 0.01;
        baseObstacleSpeed += 1.2;
      }
    }

    // Update
    function update(dt) {
      // Input
      const roadLeft = road.margin + road.edges;
      const roadRight = canvas.width - road.margin - road.edges;

      if (keys['ArrowLeft'])  player.x -= player.speed * dt;
      if (keys['ArrowRight']) player.x += player.speed * dt;

      // Clamp player inside road
      if (player.x < roadLeft) player.x = roadLeft;
      if (player.x + player.w > roadRight) player.x = roadRight - player.w;

      // Obstacles movement
      obstacles.forEach(o => { o.y += o.vy * dt; });
      // Remove off-screen
      obstacles = obstacles.filter(o => o.y < canvas.height + 80);

      // Collision detection (AABB)
      for (const o of obstacles) {
        if (o.x < player.x + player.w &&
            o.x + o.w > player.x &&
            o.y < player.y + player.h &&
            o.y + o.h > player.y) {
          gameState = STATE.GAMEOVER;
          playBtn.style.display = 'inline-block';
          playBtn.textContent = 'Play Again';
        }
      }

      // Score by survival time
      score += dt * 60; // ~60 points per second
    }

    // Draw (playing)
    function drawPlaying(dt) {
      drawRoad(dt);
      // Score
      ctx.fillStyle = '#ffffff';
      ctx.font = '16px system-ui, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText(`Score: ${Math.floor(score)}`, 12, 24);

      // Obstacles
      obstacles.forEach(drawObstacle);
      // Player
      drawPlayer();
    }

    // Main loop
    function loop(now) {
      const dt = Math.min((now - last) / 1000, 0.033); // clamp delta
      last = now;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (gameState === STATE.MENU) {
        drawMenu();
      } else if (gameState === STATE.PLAYING) {
        trySpawn(dt);
        update(dt);
        drawPlaying(dt);
      } else if (gameState === STATE.GAMEOVER) {
        drawPlaying(dt);
        drawGameOver();
      }

      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    // Button
    playBtn.addEventListener('click', () => {
      startGame();
    });

    // Start in menu, show button
    gameState = STATE.MENU;
    playBtn.style.display = 'inline-block';
  </script>
</body>
</html>
