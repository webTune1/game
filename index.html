<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vector Car Dodge Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    margin: 0;
    background: #111;
    font-family: system-ui, sans-serif;
    color: white;
    text-align: center;
  }
  h1 {
    margin: 10px 0;
    color: #ffbb33;
  }
  #playBtn {
    padding: 10px 20px;
    font-size: 16px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  #playBtn:hover { background: #218838; }
  canvas {
    background: #2b2b2b;
    display: block;
    margin: 10px auto;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
  }
</style>
</head>
<body>

<h1>ðŸš— Vector Car Dodge</h1>
<button id="playBtn">Play</button>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<p style="font-size:12px;opacity:0.8;">Arrow keys to move. Avoid traffic!</p>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const playBtn = document.getElementById("playBtn");

const STATE = { MENU:0, PLAYING:1, GAMEOVER:2 };
let gameState = STATE.MENU;

let player, obstacles, score, speed, spawnTimer, keys, lastTime;

// Road settings
const roadMargin = 40;
const roadEdge = 6;
const lanes = 3;

// Colors
const colors = {
  road: "#2b2b2b",
  edge: "#555",
  lane: "#dcdcdc",
  player: "#e74c3c",
  bus: "#f1c40f",
  car: "#3498db"
};

function initGame() {
  const roadLeft = roadMargin + roadEdge;
  const roadRight = canvas.width - roadMargin - roadEdge;
  const roadWidth = roadRight - roadLeft;
  const laneWidth = roadWidth / lanes;

  player = {
    w: 40, h: 70,
    x: roadLeft + laneWidth + (laneWidth - 40)/2, // middle lane
    y: canvas.height - 90,
    speed: 280
  };
  obstacles = [];
  score = 0;
  speed = 140;
  spawnTimer = 0;
  keys = {};
  lastTime = performance.now();
}

document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function spawnObstacle() {
  const roadLeft = roadMargin + roadEdge;
  const roadRight = canvas.width - roadMargin - roadEdge;
  const roadWidth = roadRight - roadLeft;
  const laneWidth = roadWidth / lanes;

  const laneIndex = Math.floor(Math.random() * lanes);
  const type = Math.random() < 0.3 ? "bus" : "car";
  const w = type === "bus" ? 44 : 38;
  const h = type === "bus" ? 100 : 66;
  const x = roadLeft + laneIndex * laneWidth + (laneWidth - w)/2;
  const y = -h - 10;
  const vy = speed + Math.random() * 40;

  // Some vehicles will change lanes
  let vx = 0;
  if (Math.random() < 0.25) {
    vx = (Math.random() < 0.5 ? -1 : 1) * 30; // px/sec sideways
  }

  obstacles.push({ x, y, w, h, vy, vx, type });
}
function update(dt) {
  // Player movement
  const roadLeft = roadMargin + roadEdge;
  const roadRight = canvas.width - roadMargin - roadEdge;
  if (keys["ArrowLeft"]) player.x -= player.speed * dt;
  if (keys["ArrowRight"]) player.x += player.speed * dt;
  if (player.x < roadLeft) player.x = roadLeft;
  if (player.x + player.w > roadRight) player.x = roadRight - player.w;

  // Obstacles
  for (let o of obstacles) {
    o.y += o.vy * dt;
    o.x += o.vx * dt;
    // Keep inside road
    if (o.x < roadLeft) { o.x = roadLeft; o.vx *= -1; }
    if (o.x + o.w > roadRight) { o.x = roadRight - o.w; o.vx *= -1; }
  }
  obstacles = obstacles.filter(o => o.y < canvas.height + 120);

  // Collision
  for (let o of obstacles) {
    if (o.x < player.x + player.w &&
        o.x + o.w > player.x &&
        o.y < player.y + player.h &&
        o.y + o.h > player.y) {
      gameState = STATE.GAMEOVER;
      playBtn.style.display = "inline-block";
      playBtn.textContent = "Play Again";
    }
  }

  // Score & difficulty
  score += dt * 60;
  speed += dt * 2;
  spawnTimer += dt;
  if (spawnTimer > 1.1) {
    spawnTimer = 0;
    spawnObstacle();
  }
}

function drawRoad(scroll) {
  ctx.fillStyle = colors.road;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Edges
  ctx.fillStyle = colors.edge;
  ctx.fillRect(roadMargin, 0, roadEdge, canvas.height);
  ctx.fillRect(canvas.width - roadMargin - roadEdge, 0, roadEdge, canvas.height);

  // Lane dashes
  const roadLeft = roadMargin + roadEdge;
  const roadRight = canvas.width - roadMargin - roadEdge;
  const roadWidth = roadRight - roadLeft;
  const laneWidth = roadWidth / lanes;
  ctx.fillStyle = colors.lane;
  const dashHeight = 30, dashGap = 20;
  for (let i = 1; i < lanes; i++) {
    const x = roadLeft + i * laneWidth;
    for (let y = -dashHeight; y < canvas.height + dashHeight; y += dashHeight + dashGap) {
      ctx.fillRect(x - 2, y + scroll, 4, dashHeight);
    }
  }
}

function drawVehicle(v) {
  ctx.fillStyle = v.type === "bus" ? colors.bus : colors.car;
  roundRect(v.x, v.y, v.w, v.h, 6);
  ctx.fillStyle = "rgba(255,255,255,0.2)";
  ctx.fillRect(v.x + 5, v.y + 8, v.w - 10, 14);
  ctx.fillRect(v.x + 5, v.y + v.h - 22, v.w - 10, 14);
}

function drawPlayer() {
  ctx.fillStyle = colors.player;
  roundRect(player.x, player.y, player.w, player.h, 8);
  ctx.fillStyle = "rgba(255,255,255,0.2)";
  ctx.fillRect(player.x + 5, player.y + 8, player.w - 10, 14);
}

function roundRect(x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
  ctx.fill();
}

function drawHUD() {
  ctx.fillStyle = "white";
  ctx.font = "16px sans-serif";
  ctx.textAlign = "left";
  ctx.fillText("Score: " + Math.floor(score), 10, 20);
}

function loop(now) {
  const dt = Math.min((now - lastTime) / 1000, 0.033);
  lastTime = now;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameState === STATE.MENU) {
    drawRoad(0);
    ctx.fillStyle = "white";
    ctx.font = "20px sans-serif";
    ctx.textAlign = "center";
       ctx.fillText("Press Play to start", canvas.width / 2, canvas.height / 2);
  } 
  else if (gameState === STATE.PLAYING) {
    // Scroll effect for lane dashes
    const scroll = (now / 10) % 50;
    drawRoad(scroll);
    update(dt);
    for (let o of obstacles) drawVehicle(o);
    drawPlayer();
    drawHUD();
  } 
  else if (gameState === STATE.GAMEOVER) {
    const scroll = (now / 10) % 50;
    drawRoad(scroll);
    for (let o of obstacles) drawVehicle(o);
    drawPlayer();
    drawHUD();

    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "red";
    ctx.font = "28px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2 - 20);

    ctx.fillStyle = "white";
    ctx.font = "16px sans-serif";
    ctx.fillText("Score: " + Math.floor(score), canvas.width / 2, canvas.height / 2 + 10);
    ctx.fillText("Press Play or Space to restart", canvas.width / 2, canvas.height / 2 + 35);
  }

  requestAnimationFrame(loop);
}

// Button click starts or restarts the game
playBtn.addEventListener("click", () => {
  initGame();
  gameState = STATE.PLAYING;
  playBtn.style.display = "none";
});

// Allow Space key to restart after Game Over
document.addEventListener("keydown", e => {
  if (gameState === STATE.GAMEOVER && e.key === " ") {
    initGame();
    gameState = STATE.PLAYING;
    playBtn.style.display = "none";
  }
});

// Start in menu
gameState = STATE.MENU;
playBtn.style.display = "inline-block";
lastTime = performance.now();
requestAnimationFrame(loop);
</script>
</body>
</html>
